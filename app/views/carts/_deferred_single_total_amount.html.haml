:javascript
  $.ajax({
    url:'/carts/get_total_amount', 
    tryCount : 0,
    retryLimit : 10,
    success: function(data) {$('#deferred_single_total_amount').html(data);$('#payment_submit').button({disabled: false, label: button_label});},
    beforeSend: function() {$('#payment_submit').button({disabled: true, label: 'please wait...'});$('#deferred_single_total_amount').html('#{escape_javascript loader_bar}')},
    error : function(xhr, textStatus, errorThrown ) {
      if (xhr.status == 510) {
        this.tryCount++;
        if (this.tryCount <= this.retryLimit) {
          $(this).doTimeout( 'retrying_deferred', 1000, function(){
            console.log('retrying_deferred...');
            $.ajax(this[0]);
          });
        }
      }
    }
  })
