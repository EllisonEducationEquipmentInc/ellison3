- cache "navigation_#{current_system}", :expires_in => 1.minute do
  - @top_navigations.each do |top_nav|
    %li.megaitem.ui-corner-top
      = link_to top_nav.label, top_nav.link, :class => "megalink", :onclick => "$(this).siblings('div.megapanel').hide(); return true;"
      .megapanel{:class => @top_navigations.index(top_nav) > 4 ? 'reverse' : nil}
        - Navigation.where(:system => current_system, :top_nav => @top_navigations.index(top_nav)).asc(:column).each do |nav|
          %ul.contentwrap_XS
            %li.listtitle.first= nav.label
            %ul
              - if nav.navigation_type == 'static'
                - nav.navigation_links.ordered.each do |link|
                  %li= link_to link.label, link.link
              - elsif nav.navigation_type == 'product_tag'
                - perform_search(Product, :facets => [nav.tag_type], :ignore_keyword => true).facet("#{nav.tag_type}_#{current_system}").rows.each do |row|
                  %li= link_to row.instance.name, "/catalog#facets=#{row.value}"
              - elsif nav.navigation_type == 'idea_tag'
                - perform_search(Idea, :facets => [nav.tag_type], :ignore_keyword => true).facet("#{nav.tag_type}_#{current_system}").rows.each do |row|
                  %li= link_to row.instance.name, "/catalog#facets=#{row.value}&ideas=1"