- content_for :gmap_header do
  = javascript_include_tag 'http://maps.google.com/maps/api/js?v=3.3&sensor=false'
  = javascript_include_tag '/javascripts/vendor/markermanager.js'
  = javascript_include_tag '/javascripts/vendor/StyledMarker.js'
  / = javascript_include_tag '/javascripts/vendor/jquery.metadata.js'
  = javascript_include_tag 'jquery.jmapping.js'
.tab-block
  %h2{:style=>"margin:4px 0 0 14px;"} Search Selection:
  %ul
    %li.rounded_top= link_to "Stores", "#stores"
    %li.rounded_top= link_to "Online Retailers", "#online_retailers"
    %li.rounded_top= link_to "Distributors", "#distributors"
    %li.rounded_top= link_to "Major Retailers", "#major_retailers"
  #stores
    %p{:class=>"storedescription"} Most of the products that you love are available through our website or at your local craft store. Although we don't sell selected items online, we'll put you in touch with a retailer who might. Be sure to call ahead for product availability. Can't find a retailer near you? We're always adding new retail locations, so check back soon!
    #store_info
      = form_tag '#', :onsubmit => 'return false' do
        .field 
          %h2 Search by Country:
          = select_tag :country, options_for_select(@countries, params[:country]), :onchange => "toggle_store_fields()"
        .field.us_only
          %h2 Search by Zip Code:
          = text_field_tag :zip_code, params[:zip_code]
        .field.us_only
          %h2 Search by Radius:
          = select_tag :radius, options_for_select([5,10,20,30,50], params[:radius] || 5)
          miles
        .field
          %h2 Search by Brands:
          = check_box_tag 'brands[]', "sizzix", params[:brands].present? && params[:brands].include?('sizzix'), :id => "brands_sizzix", :class => 'brands'
          Sizzix
          = check_box_tag 'brands[]', "ellison", params[:brands].present? && params[:brands].include?('ellison'), :id => "brands_ellison", :class => 'brands'
          Ellison
        .field
          = link_to 'search', '#', :id => 'map_search_submit'
      %div{:style=>" float:left; border: 1px solid #CCCCCC; width:254px; height: 424px; margin-bottom: 12px; overflow: scroll; border-top:1px solid gray; background:white;"}
        #map-side-bar
    .storeframe
      #map
  .clear
  #online_retailers
    %h2 Online Retailers
    - @online_stores.each do |store|
      .online_store= render store
    .clear
  #distributors 
    %h2 Distributors
    - @distributors.each do |store|
      .online_store= render store
    .clear
  #major_retailers 
    %h2 Major Retailers
    have no clue what goes here
- if @store_locator_content.present?
  #current_visual_assets= render @store_locator_content.visual_assets.current
:javascript
  $(document).ready(function(){
    $(".tab-block").tabs();
    toggle_store_fields();
    $.getScript('/javascripts/vendor/jquery.metadata.js', function() {
      $('#map').jMapping({default_point: {lat: 40.513799, lng:-98.876953}, default_zoom_level: 3, link_selector: '.map-link'});
    });
    $('#map_search_submit').click( function() {
      if ($('#country').val() == 'United States' && $('#zip_code').val().length < 5) {
        alert('invalid zip code');
        return false;
      }
      if ($('.brands:checked').length < 1){
        alert('please select at least one brand');
        return false;
      }
      $.ajax({url:'/index/update_map?'+$(this).parents('form').serialize(), success: function(html){
        $('#map-side-bar').html(html);
        $('#map').jMapping('update');
        $('.info-box').show();
        $('.info-box h3').css('cursor', 'pointer');
      }});
      return false;
    });
    if ($('#country').val() != 'United States') $('#map_search_submit').trigger('click');
  }).bind('afterMapping.jMapping', function(e,m) {
    setTimeout("$('#map').data('jMapping').map.setZoom(4)", 1200);
  });
  function toggle_store_fields(){
    if ($('#country').val() == 'United States'){
      $('.us_only').show();
    } else {
      $('.us_only').hide();
    }
  }
  

