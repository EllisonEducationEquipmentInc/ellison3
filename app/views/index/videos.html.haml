-#- cache "videos_page_#{current_system}", :expires_in => 60.minutes do
%h2== Videos
#featured_video
  %h3 Featured Video
  - playlist =  @channel.playlists.where(title: "Featured_#{current_system}").first
  - video = playlist.playlist_items.first if playlist
  - if video
    %ul.videolist
      %li
        .video-thumbnail
          .play-button.tooltip_playvideo= link_to "play", video_default_image(video) + "&autoplay=1&fs=1", :class => "fancyvideo", :id => yt_video_url(video), :rel => j(video.title)
          %img{ :src => video_default_image(video), :width => "390", :height => "291" }
        %p.video-title
          %span== Today's Featured #{system_name.titleize} Video: 
          = link_to video.title, yt_video_url(video) + "&autoplay=1&fs=1", :class => "fancyvideo", :id => video_default_image(video), :rel => j(video.title)
        %p.video-detail
          == #{l video.published_at, :format => :date_short}
          -#|
          -#== #{playlist.videos.first.duration/60} min #{playlist.videos.first.duration%60} seconds 
          -#|
          -#== #{playlist.videos.first.view_count} views
        - unless video.description.blank?
          %p.video-description= truncate(video.description, :length => 200, :separator => ' ')
#recent_videos
  %h3 Our Most Recent Uploads
  - if @recent_uploads.present?
    %ul.videolist
      - @channel.videos.where(order: 'date').each do |video|
        = render :partial => 'video', locals: { video: video }
  - else
    %p.msg No videos have been uploaded within the past month.

  -##search_videos
    -#%h3== Search #{system_name.capitalize} Videos
    -#= text_field_tag :video_keyword, nil, :autocomplete => "off", :value => "enter keywords", :onfocus => "if (this.value == 'enter keywords'){this.value='';}", :onblur => "if (this.value == ''){this.value='enter keywords';}", :size => 50
    -#:javascript
      -#$("#video_keyword").addClass("idlefield");
      -#$("#video_keyword").focus(function(){
        -#$(this).addClass("activefield").removeClass("idlefield");
      -#}).blur(function(){
        -#$(this).removeClass("activefield").addClass("idlefield");
      -#});

    -#%span.jqui_search Search

.contentwrap_XXXL.last
  .tab-block
    %ul
      - @videos.reject {|e| e.title =~ /featured/i}.each do |playlist|
        %li= link_to playlist.title, "##{playlist.title.parameterize}"
      - @channel.playlists.each do |playlist|
        %li= link_to playlist.title, "##{playlist.title.parameterize}"
      %li= link_to "Search Results", "#search_results"
    - @channel.playlists.each do |playlist|
      = render :partial => 'playlist', locals: { playlist: playlist } #@videos.reject {|e| e.title =~ /featured/i}
    #search_results
      %h3 Search Results
      .highlightable
        %ul.videolist#video_search      
  :javascript
    $('.pagination.ajax a').live('click', function() {this.innerHTML='#{escape_javascript spinner}';$(this).closest('.video_content').load(this.href);return false;})
    $('#video_keyword').change(function() {
      if (this.value.length < 3) {
        return false;
      } else {
        $('.tab-block').tabs("select", $('.tab-block').tabs("length") - 1);
        location.hash = $.param.fragment( location.hash, {q: this.value}, 0 );
        $.ajax({url:'/index/search_videos?q='+this.value, success: function(data){
          $('#video_search').html(data);
          highlight_keyword();
          $('#video_keyword').val('');
          youtube_video_links();
        }});
      }
    });
- if params[:v].present?
  :javascript
    $(document).ready(function(){$('##{params[:v]}').trigger('click')});
