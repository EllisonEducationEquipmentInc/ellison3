%li.ui-menu-item
  = f.text_field :product_id, :class => 'individual_product_id', :readonly => true
  = f.text_field :item_num, :placeholder => "item num", :class => 'product_autocomplete'
  = f.select :discount_type, Campaign::DISCOUNT_TYPES, {}, :class => 'individual_discount_type'
  = f.text_field :discount, :placeholder => "discount value", :class => 'individual_discount_value', :onkeyup => "$(this).siblings('input.individual_product_price').val(calculate_sale_price($(this).siblings('input.individual_product_msrp').val(), this.value, $(this).siblings('.individual_discount_type').val()))", :onblur => "add_individual_discount();$(this).parent('li').next('li').find('.product_autocomplete').focus();"
  = f.text_field :msrp, :placeholder => "msrp", :size => 5, :readonly => true, :class => 'individual_product_msrp'
  = f.text_field :price, :placeholder => "sales price", :size => 8, :class => 'individual_product_price', :readonly => true
  
  = link_to_function "remove", "$(this).parent('li').remove()"
  %br
  = f.text_field :label, :class => 'transperent product_info', :readonly => true, :size => 150
  :javascript
    $(".product_autocomplete").autocomplete({
      source: function(request, response) {
        $.getJSON("/admin/products/products_autocomplete", {
          term: extractLast(request.term)
        }, response);
      },
      search: function() {
        var term = extractLast(this.value);
        if (term.length < 3) {
          return false;
        }
      },
      focus: function() {
        return false;
      },
      select: function(event, ui) {
        this.value = split(ui.item.value).pop(); 
        $(this).siblings('.product_info').val(ui.item.label+' MSRP: '+ui.item.msrp);
        $(this).siblings('input.individual_product_msrp').val(ui.item.msrp);
        $(this).siblings('input.individual_product_id').val(ui.item.id);
        $(this).siblings('select.individual_discount_type').focus();
        $("#tag_products").append("<li class='ui-menu-item'><a href='#' onclick='$(this).parent().remove();return false;'>x</a> "+ui.item.label+"<input name=\"tag[my_product_ids][]\" type=\"hidden\" value=\""+ui.item.id+"\" /></li>");
        return false;
      }
    });