- form_for @tab, :url => {:action => @tab.new_record? ? 'create_tab' : 'update_tab', :id => @tab.id}, :remote => true do |f| 
  .field
    = f.label :name
    = f.text_field :name
    = hidden_field_tag :product_id, @tab.product.id
  .field
    = f.label :active
    %br
    = f.check_box :active
  .field
    = f.label :systems_enabled
    = system_enabled('tab')
  .field
    = f.label :description
    = f.text_field :description
  .field
    = f.label :text
    = f.text_area :text
  .field
    = f.label :products
    = f.text_field :product_item_nums, :size => 50
    Enter item numbers seperated by commas
  .actions
    = f.submit :class => 'wymupdate'
    = link_to 'cancel', '#', :onclick => "$('#edit_tab').html(''); return false;"
:javascript
  $("#tab_text").wymeditor();
  $(function() {
  		function split(val) {
  			return val.split(/,\s*/);
  		}
  		function extractLast(term) {
  			return split(term).pop();
  		}

  		$("#tab_product_item_nums").autocomplete({
  			source: function(request, response) {
  				$.getJSON("/admin/products/products_autocomplete", {
  					term: extractLast(request.term)
  				}, response);
  			},
  			search: function() {
  				// custom minLength
  				var term = extractLast(this.value);
  				if (term.length < 2) {
  					return false;
  				}
  			},
  			focus: function() {
  				// prevent value inserted on focus
  				return false;
  			},
  			select: function(event, ui) {
  				var terms = split( this.value );
  				// remove the current input
  				terms.pop();
  				// add the selected item
  				terms.push( ui.item.value );
  				// add placeholder to get the comma-and-space at the end
  				terms.push("");
  				this.value = terms.join(", ");
  				return false;
  			}
  		});
  	});