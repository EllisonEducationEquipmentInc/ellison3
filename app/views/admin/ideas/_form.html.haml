= form_for([:admin, @idea], :html => {:multipart => true}) do |f|
  = f.error_messages
  .field
    = f.label :systems_enabled
    = system_enabled('idea')
  .field
    = f.label :active
    %br
    = f.check_box :active
  .field
    = f.label :idea_num, "Idea Group"
    %br
    = f.text_field :idea_num
  .field
    = f.label :item_group
    %br
    = f.select :item_group, Product::ITEM_GROUPS
  .field
    = f.label :name
    %br
    = f.text_field :name
  .field
    = f.label :use_tabs
    %br
    = f.check_box :use_tabs
  .field
    = f.label "start_date_#{current_system}", "Start Date #{current_system.upcase}", :class => 'overrideable'
    %br
    = f.text_field "start_date_#{current_system}", :class => 'datetimepicker'
  .field
    = f.label "end_date_#{current_system}", "End Date #{current_system.upcase}", :class => 'overrideable'
    %br
    = f.text_field "end_date_#{current_system}", :class => 'datetimepicker'
  .field
    = f.label "distribution_life_cycle_#{current_system}", "Distribution Life Cycle #{current_system.upcase}", :class => 'overrideable'
    %br
    = f.text_field "distribution_life_cycle_#{current_system}", :class => 'overrideable', :size => 100
  .field
    = f.label "distribution_life_cycle_ends_#{current_system}", "Distribution Life Cycle Ends #{current_system.upcase}", :class => 'overrideable'
    %br
    = f.text_field "distribution_life_cycle_ends_#{current_system}", :class => 'datetimepicker'
  .field
    = f.label :keywords
    %br
    = f.text_area :keywords
  .field
    = f.label :description, :class => 'overrideable'
    %br
    = f.text_area :description, :class => 'wymeditor'
  .field
    = f.label :objective
    %br
    = f.text_area :objective, :class => 'wymeditor'
  .field
    = image_tag(@idea.image_url(:small)) if @idea.image? 
    = f.file_field :image
    = f.hidden_field :image_cache
    %br
    = f.label :remove_image
    = f.check_box :remove_image
  .field
    = f.label :video, "Youtube video ID. Example: iOGVK7Mih7w"
    %br
    = f.text_field :video
  %br
  - unless @idea.new_record?
    %h3 Tags
    %ul#idea_tags= render :partial => 'tag', :collection => @idea.tags, :locals => {:idea_id => @idea.id}
    = label_tag :idea_tags_helper
    = text_field_tag "idea_tags_helper"
    %br
    %br
    %h3 Products
    %ul#idea_products= render :partial => 'product', :collection => @idea.products, :locals => {:idea_id => @idea.id}
    = label_tag :idea_products_helper
    = text_field_tag "idea_products_helper"
  %br
  %br
  %h3 Related Idea Tag
  .field
    = f.label :related_idea_tag, "Related Idea Tag ID"
    %br
    = f.text_field :related_idea_tag
    %span#related_idea_tag_name= @idea.related_idea_tag_name
    :javascript
      $('#idea_related_idea_tag').autocomplete({
      	source: function(request, response) {
      		$.getJSON("/tags_autocomplete", {
      			term: request.term
      		}, response);
      	},
      	search: function() {
      		if (this.value.length < 2) {
      			return false;
      		}
      	},
      	focus: function( event, ui ) {
        				return false;
        			},
      	select: function(event, ui) {
      	  $("#related_idea_tag_name").html( ui.item.label );
          $(this).val( ui.item.id );
          return false;
        }});
  .actions
    = f.submit :class => 'wymupdate jqui_save'
  :javascript
    $(function() {
      $('#idea_distribution_life_cycle_#{current_system}').autocomplete({source: ["New", "Featured"]});
    });
    $("#idea_tags_helper").autocomplete({
    	source: function(request, response) {
    		$.getJSON("/tags_autocomplete", {
    			term: request.term
    		}, response);
    	},
    	search: function() {
    		if (this.value.length < 2) {
    			return false;
    		}
    	},
    	focus: function( event, ui ) {
      				$( "#idea_tags_helper" ).val( ui.item.label );
      				return false;
      			},
    	select: function(event, ui) {
    	  this.value = '';
    	  $.ajax({url:'/admin/ideas/add_tag?tag_id='+ui.item.id+'&id=#{@idea.id}', success: function(html) {$('#idea_tags').append(html)}});
    		return false;
    	}});
    	
    	$("#idea_products_helper").autocomplete({
      	source: function(request, response) {
      		$.getJSON("/products_autocomplete", {
      			term: request.term
      		}, response);
      	},
      	search: function() {
      		if (this.value.length < 2) {
      			return false;
      		}
      	},
      	focus: function( event, ui ) {
        				$( "#idea_products_helper" ).val( ui.item.label );
        				return false;
        			},
      	select: function(event, ui) {
      	  this.value = '';
      	  $.ajax({url:'/admin/ideas/add_product?product_id='+ui.item.id+'&id=#{@idea.id}', success: function(html) {$('#idea_products').append(html)}});
      		return false;
      	}});