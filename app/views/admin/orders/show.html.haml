%h2== Order - #{@order.id}
.back= link_to "Back to Orders", admin_orders_path
- I18n.locale = @order.locale
.contentwrap_medium
  %h3 Billing Address
  %p
    - unless @order.payment.company.blank?
      = @order.payment.company
      %br
    == #{@order.payment.first_name} #{@order.payment.last_name}
    %br
    = @order.payment.address1
    %br
    - unless @order.payment.address2.blank?
      = @order.payment.address2
      %br
    == #{@order.payment.city}, #{@order.payment.state} #{@order.payment.zip_code}
    %br
    = @order.payment.country
    %br
    = @order.payment.phone
.contentwrap_medium
  %h3 Shipping Address
  %p
    -  unless @order.address.company.blank?
      = @order.address.company
      %br
    == #{@order.address.first_name} #{@order.address.last_name}
    %br
    = @order.address.address1
    %br
    - unless @order.address.address2.blank?
      = @order.address.address2
      %br
    == #{@order.address.city}, #{@order.address.state} #{@order.address.zip_code}
    %br
    = @order.address.country
    %br
    = @order.address.phone
.contentwrap_medium.last
  %h3 Details
  %strong System:
  = @order.system
  %br
  %strong Order ID:
  = @order.id
  %br
  %strong Order Number:
  = @order.public_order_number
  %br
  - if @order.quote
    %strong== #{quote_name.capitalize} Reference Number:
    = link_to @order.quote.id, admin_quote_path(@order.quote)
    %br
  %strong Web Customer Number:
  = @order.user.id
  %br
  %strong Customer Account:
  = @order.user.email
  %br
  %strong Order Date:
  = l @order.created_at, :format => :custom
  %br
  %strong Status:
  %span#order_status= @order.status
  %br
  %strong Customer Rep:
  = @order.customer_rep
  - unless @order.order_reference.blank?
    %br
    %strong Order Reference ID:
    = link_to @order.order_reference, admin_order_path(@order.order_reference)
  %div{:class => @order.user.erp.blank? || @order.user.invoice_account.blank? ? 'error' : nil}
    %strong ERP ID:
    = @order.user.erp
    = link_to 'edit', edit_admin_user_path(@order.user)
    %br
    %strong Invoice Account:
    = @order.user.invoice_account
    = link_to 'edit', edit_admin_user_path(@order.user)
    %br
  #order_actions= render :partial => 'order_actions'
.clear
%table
  %tr
    %th Item No.
    %th Item Name
    %th Quantity
    %th Item Price
    %th Item Subtotal
    %th Custom
    %th Coupon
  - @order.order_items.each do |item|
    %tr{:class => cycle('odd', 'even')}
      %td= item.item_num
      %td= item.name
      %td= item.quantity
      %td= number_to_currency item.gross_price
      %td= number_to_currency item.item_total
      %td= item.custom_price
      %td= item.coupon_price
.contentwrap_XL &nbsp;
%ul.plain.cart_summary.contentwrap_medium.last
  %li
    Subtotal:
    %span.right= number_to_currency @order.gross_subtotal_amount
  %li
    == Shipping & Handling (#{@order.shipping_service.try :humanize}):
    %span.right#shipping_amount= number_to_currency @order.gross_shipping_amount
  %li
    Shipping & Handling Surcharge:
    %span.right= number_to_currency @order.handling_amount
  %li
    Sales Tax:
    %span.right#tax_amount= number_to_currency @order.tax_amount
  %li#cart_total
    TOTAL:
    %span.right#total_amount.amount= number_to_currency @order.total_amount
  %li    
    - if @order.payment.try(:purchase_order)
      .error
        %strong Purchase Order
        = @order.payment.purchase_order_number
        = link_to "download", @order.payment.attachment_url, :class => "link_download", :target => "_blank" if @order.payment.attachment
    - else
      This order was charged to:
      = @order.payment.card_name
      == #{@order.payment.card_expiration_month}/#{@order.payment.card_expiration_year}
%br
%br
- if @order.coupon
  .field
    %strong Coupon:
    = link_to @order.coupon_code || @order.coupon.codes.join(", "), admin_coupon_path(@order.coupon)
    = @order.coupon.name
.field{:class => @order.payment.paid_amount && @order.payment.paid_amount < @order.total_amount ? 'error' : nil}
  %strong Paid Amount:
  = number_to_currency @order.payment.paid_amount rescue "N/A"
.field
  %strong Paid At:
  = l @order.payment.paid_at, :format => :custom rescue ""
.field
  %strong Merchant Reference Number:
  = @order.payment.vendor_tx_code
.field
  %strong Transaction ID:
  = is_us? ? @order.payment.vpstx_id : @order.payment.tx_auth_no
.field
  %strong Tax Transaction ID:
  %span#tax_transaction= @order.tax_transaction
.field
  %strong Tax Calculated at:
  %span#tax_calculated_at= l @order.tax_calculated_at, :format => :custom rescue ''
.field
  %strong Order Comments:
  = @order.comments
.field
  %strong Internal Comments:
  #internal_comment= @order.internal_comments
- I18n.locale = @current_locale
- if has_write_permissions?
  :javascript
    $("#internal_comment").editInPlace({
      url: "/admin/orders/update_internal_comment",
      params: "id=#{@order.id}",
      field_type: "textarea",
      textarea_rows: "15",
      textarea_cols: "35",
      show_buttons: true,
      saving_animation_color: "#ECF2F8"
    });